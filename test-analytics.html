<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Analytics - Nerally</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Analytics Test - Nerally</h1>
    
    <div id="results"></div>
    
    <h2>Tests</h2>
    <button onclick="testGTMLoad()">Test GTM Loading</button>
    <button onclick="testGA4Load()">Test GA4 Loading</button>
    <button onclick="testDataLayer()">Test DataLayer</button>
    <button onclick="testCookieConsent()">Test Cookie Consent</button>
    <button onclick="clearResults()">Clear Results</button>

    <script>
    // Site config (like in main site)
    window.SITE_CONFIG = {
        BASE_URL: window.location.origin || '',
        GTM_ID: 'GTM-MN565XBX',
        GA4_ID: 'G-84CY5EBJJX',
        RECAPTCHA_SITE: '6Lcd7dcrAAAAADzfwDc4AG_kN6jKU0-0Fo78NmYx'
    };

    function addResult(message, type = 'info') {
        const div = document.createElement('div');
        div.className = `status ${type}`;
        div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
        document.getElementById('results').appendChild(div);
    }

    function clearResults() {
        document.getElementById('results').innerHTML = '';
    }

    function testGTMLoad() {
        addResult('Testing GTM loading...', 'info');
        
        // Check if GTM script exists
        const gtmScripts = Array.from(document.scripts).filter(s => 
            s.src && s.src.includes('googletagmanager.com/gtm.js')
        );
        
        if (gtmScripts.length > 0) {
            addResult(`‚úÖ GTM script found: ${gtmScripts[0].src}`, 'success');
        } else {
            addResult('‚ùå GTM script not found', 'error');
        }

        // Check if GTM container loads
        const testLoad = () => {
            const script = document.createElement('script');
            script.async = true;
            script.src = `https://www.googletagmanager.com/gtm.js?id=${window.SITE_CONFIG.GTM_ID}`;
            
            script.onload = () => {
                addResult('‚úÖ GTM container loads successfully', 'success');
            };
            
            script.onerror = () => {
                addResult('‚ùå GTM container failed to load', 'error');
            };
            
            document.head.appendChild(script);
        };

        testLoad();
    }

    function testGA4Load() {
        addResult('Testing GA4 loading...', 'info');
        
        // Check if gtag scripts exist
        const gtagScripts = Array.from(document.scripts).filter(s => 
            s.src && s.src.includes('googletagmanager.com/gtag/js')
        );
        
        if (gtagScripts.length > 0) {
            addResult(`‚úÖ GA4 gtag script found: ${gtagScripts[0].src}`, 'success');
        } else {
            addResult('‚ùå GA4 gtag script not found', 'error');
        }

        // Check if gtag function exists
        if (typeof window.gtag === 'function') {
            addResult('‚úÖ gtag function is available', 'success');
            
            // Send test event
            gtag('event', 'test_event', {
                'event_category': 'analytics_test',
                'event_label': 'manual_test_from_diagnostic_page'
            });
            
            addResult('‚úÖ Test event sent via gtag', 'success');
        } else {
            addResult('‚ùå gtag function not available', 'error');
        }

        // Test GA4 measurement ID
        const expectedId = window.SITE_CONFIG.GA4_ID;
        addResult(`‚ÑπÔ∏è Expected GA4 ID: ${expectedId}`, 'info');
    }

    function testDataLayer() {
        addResult('Testing DataLayer...', 'info');
        
        if (typeof window.dataLayer !== 'undefined') {
            addResult(`‚úÖ DataLayer exists with ${window.dataLayer.length} items`, 'success');
            
            // Push test event
            window.dataLayer.push({
                'event': 'test_event',
                'test_category': 'analytics_test',
                'test_action': 'manual_test'
            });
            
            addResult('‚úÖ Test event pushed to DataLayer', 'success');
        } else {
            addResult('‚ùå DataLayer not found', 'error');
            
            // Initialize DataLayer
            window.dataLayer = window.dataLayer || [];
            addResult('‚ÑπÔ∏è DataLayer initialized manually', 'info');
        }
    }

    function testCookieConsent() {
        addResult('Testing Cookie Consent...', 'info');
        
        // Check local storage
        const consent = localStorage.getItem('nerally-cookie-consent');
        const analytics = localStorage.getItem('nerally-analytics-consent');
        
        if (consent) {
            addResult(`‚úÖ Consent stored: ${consent}`, 'success');
        } else {
            addResult('‚ùå No consent found in localStorage', 'error');
        }
        
        if (analytics) {
            addResult(`‚úÖ Analytics consent: ${analytics}`, 'success');
        } else {
            addResult('‚ùå No analytics consent found', 'error');
        }

        // Check cookies
        const gaCookies = document.cookie.split(';').filter(c => 
            c.trim().startsWith('_ga') || c.trim().startsWith('_gid')
        );
        
        if (gaCookies.length > 0) {
            addResult(`‚úÖ Found ${gaCookies.length} GA cookies: ${gaCookies.map(c => c.split('=')[0].trim()).join(', ')}`, 'success');
        } else {
            addResult('‚ùå No Google Analytics cookies found', 'error');
        }
    }

    // Auto-run basic tests
    window.addEventListener('load', () => {
        addResult('üöÄ Analytics Test Started', 'info');
        setTimeout(() => {
            testDataLayer();
            testCookieConsent();
        }, 1000);
    });
    </script>
</body>
</html>